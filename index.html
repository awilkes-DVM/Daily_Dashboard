<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>BTC/ETH Daily Drivers Dashboard</title>

<style>
:root{
--bg:#0b0f14; --panel:#111824; --panel2:#0f1622; --text:#e7eef9;
--muted:#9bb0c7; --green:#2dd4bf; --amber:#fbbf24; --red:#fb7185;
--line:#1f2a3a; --chip:#0b1220;
--mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
--sans: ui-sans-serif, system-ui;
}
body{margin:0;background:var(--bg);color:var(--text);font-family:var(--sans);}
.wrap{max-width:1200px;margin:0 auto;padding:18px;}
.card{background:linear-gradient(180deg,var(--panel),var(--panel2));
border:1px solid var(--line);border-radius:14px;padding:12px;margin-bottom:14px;}
.section-title{font-size:14px;margin-bottom:10px}
.row{display:grid;gap:12px}
.cols4{grid-template-columns:repeat(4,1fr)}
.cols2{grid-template-columns:repeat(2,1fr)}
.metric-label{font-size:12px;color:var(--muted)}
.metric-val{font-size:20px;font-family:var(--mono)}
.flag{border:1px solid var(--line);border-radius:12px;padding:8px;margin-bottom:6px;background:#0b1220}
.badge{padding:4px 8px;border-radius:999px;font-size:11px}
.badge.green{color:var(--green)} .badge.amber{color:var(--amber)} .badge.red{color:var(--red)}
textarea,input{width:100%;background:#0b1220;color:var(--text);border:1px solid var(--line);border-radius:10px;padding:8px}
.btn{background:#0b1220;border:1px solid var(--line);color:white;padding:8px;border-radius:10px;cursor:pointer}
.divider{height:1px;background:var(--line);margin:12px 0}
.small{font-size:12px;color:var(--muted)}
</style>
</head>

<body>
<div class="wrap">

<h1>BTC/ETH Daily Drivers Dashboard</h1>

<!-- ===================== FAT TAIL RISK PANEL ===================== -->
<div class="card">
<div class="section-title">Portfolio Risk (Fat Tail Aware)</div>
<div class="divider"></div>

<div class="row cols4" id="riskTopRow"></div>

<div class="divider"></div>

<div class="row cols2">
<div class="card"><div class="section-title">Sleeves</div><div id="riskSleevesTable"></div></div>
<div class="card"><div class="section-title">Hedge Health</div><div id="riskHedgeTable"></div></div>
</div>

<div class="divider"></div>

<div class="row cols2">
<div class="card">
<div class="section-title">Risk Data Source</div>
<input id="riskEndpoint" placeholder="https://awilkes-dvm.github.io/Daily_Dashboard/risk.json"/>
<button class="btn" id="riskSaveEndpointBtn">Save endpoint</button>
<button class="btn" id="riskFetchBtn">Fetch now</button>
</div>

<div class="card">
<div class="section-title">Manual JSON</div>
<textarea id="riskJsonBox"></textarea>
<button class="btn" id="riskRenderBtn">Render</button>
</div>
</div>
</div>

</div>

<script>
function fmtPct(x){return (x*100).toFixed(1)+"%"}
function metricCard(label,val,sub){return `<div class="card"><div class="metric-label">${label}</div><div class="metric-val">${val}</div><div class="small">${sub||""}</div></div>`}

function renderRisk(data){
document.getElementById("riskTopRow").innerHTML =
metricCard("NAV","$"+data.nav_usd,"as of "+data.asof)+
metricCard("Portfolio Vol",fmtPct(data.portfolio.vol_ann),"target "+fmtPct(data.portfolio.vol_target_ann))+
metricCard("Drawdown",fmtPct(data.portfolio.drawdown))+
metricCard("Regime","Auto");

document.getElementById("riskSleevesTable").innerHTML =
`Crypto ${fmtPct(data.sleeves.crypto)}<br>Gold ${fmtPct(data.sleeves.gold)}<br>Hedge ${fmtPct(data.sleeves.hedge)}<br>Cash ${fmtPct(data.sleeves.cash)}`;

document.getElementById("riskHedgeTable").innerHTML =
`Annual cost ${fmtPct(data.hedge.annual_cost)}<br>Payout -40% ${fmtPct(data.hedge.payout_btc_m40)}`;
}

function saveEndpoint(){localStorage.setItem("riskEP",document.getElementById("riskEndpoint").value)}
async function fetchRisk(){const r=await fetch(localStorage.getItem("riskEP"));renderRisk(await r.json())}

document.getElementById("riskSaveEndpointBtn").onclick=saveEndpoint;
document.getElementById("riskFetchBtn").onclick=fetchRisk;
document.getElementById("riskRenderBtn").onclick=()=>renderRisk(JSON.parse(document.getElementById("riskJsonBox").value));

if(localStorage.getItem("riskEP")) fetchRisk();
async function safeFetchRisk(){
  try{
    const ep = localStorage.getItem("riskEP") || document.getElementById("riskEndpoint")?.value?.trim();
    if(!ep) return; // donâ€™t crash the page
    const r = await fetch(ep + (ep.includes("?") ? "&" : "?") + "t=" + Date.now()); // cache-bust
    if(!r.ok) throw new Error("HTTP " + r.status);
    const js = await r.json();
    renderRisk(js);
  }catch(e){
    console.log("Risk fetch failed:", e);
  }
}

setInterval(safeFetchRisk, 60_000);
safeFetchRisk();

</script>
</body>
</html>
